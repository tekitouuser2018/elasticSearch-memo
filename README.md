# elasticSearch-memo


### Elasticsearchの特徴
----
Apach Luceneをベースとした、Javaで書かれた全文検索ソフトウェア。
ライセンス： Apache License2.0(オープンソースソフトウェア)
サポートポリシー： 各リリースの一般提供開始日から１８ヶ月間がサポート期間
メンテナンスポリシー： 最新２世代のメジャーバージョンに対してのみメンテナンスが行われる

- 分散配置による高速化と高可用性の実現
- シンプルなREST APIによるアクセス
- JSONフォーマットに対応した柔軟性の高いドキュメント指向データベース
- ログ収集・可視化などの多様な関連ソフトウェアとの連携


### レイヤー
----

- indexer


- searcher


- crawler


- 検索ライブラリレイヤー
インデクサとサーチャーの機能を提供するレイヤとなるソフトウェア形態
例：Apach Lucine

- 検索サーバレイヤー
インターフェースや管理機能を提供するレイヤ
例：Elasticsearch, Apache Solr

- 検索システムレイヤー(エンタープライズサーチ)
クローラやWeb UI機能を付加したレイヤｂｇ


### 論理的な概念
----

- Document:　 
Elasticsearchに格納する１つの文章の単位でJSONオブジェクト。RDBの１行のレコードに該当。

- Fiels:
ドキュメント内のkey,valueの組。

- Index:
ドキュメントの保存場所。RDBのテーブルに該当

- Document type:
ドキュメントの構造。１つのインデックスの中に格納できるドキュメントタイプは１つのみ

- Mapping:
ドキュメント内の各フィールドのデータ構造やデータ型を記述した情報。
事前定義しなくても、ドキュメント格納時に自動的に定義してくれる。

### 物理的な概念
----

- Node:
Elasticsearchが動作する各サーバのこと。(=JVMインスタンス)
１つのOS上に１ノードだけ起動するのが典型

- Cluster:
複数のノードを起動すると、お互いにメッセージを送信しあい、自律的に形成するノードのグループ

- Shard:
インデックスのデータを一定数に分割した各部分のこと。
初期設定数は「５」。事前に設定しておく必要があり、後から変更はできない。

- Replica:
各シャードが自動的に複製されたのも。インデックスが更新される際は、必ず最初にプライマリシャーとに反映されてから、逐次レプリカシャードを複製するようになっている。
インデックス作成後も設定数は変更可能。


### システム構成
----

- ノード種別
 - Master(Master-eligible)ノード:
   Elasticsearchクラスタには、必ず１台のMasterノードが必要。
   - ノードの参加と離脱の管理
   - クラスタメタデータの管理
   - シャードの割り当てと再配置
 - Dataノード: Elasticsearchにおけるデータの格納、クエリへの応答、そして内部的にLuceneインデックスファイルのマージなどの管理を行う役割を持ちます。また、クライアントから受け付けたリクエストのハンドリングも行います。
 - Ingestノード: ver5.0から登場。Elasticsearchノードの内部でデータの変換や加工を実行できる機能。
 - Coordinatingノード: クライアントからのリクエストのハンドリングのみを実行。


### スプリットブレイン問題について
----

スプリットブレインとは、Elasticsearchクラスタが２つに分断されて、かつ、それぞれのクラスタ上でMasteerノードが独立して稼働してしまう状態のこと。これを回避するためにMasterノードを高可用性構成にする場合、Master-eligibleノードは3ノード以上の奇数台で構成する必要がある。

- 必須対処方法
 - Master-eligibleノードの数を３以上の奇数にすること
 - elasticsearch.yml設定ファイルのパラメータ「discovery.zen.minimum_master_nodes」の数をMaster-eligibleノード数の過半数に設定すること((N/2)+1)。このパラメータはデフォルト値が「１
 」
